<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../icons/favicon.ico">
    <title>BNU - 课程表test</title>
    <style>
        /* ========== 基础重置 & 全局变量 ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            list-style: none;
            text-decoration: none;
        }
        body {
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
            font-family: "幼圆", "Comic Sans MS", monospace;
        }
        .page-layout {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            align-items: flex-start;
        }
        .theme-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #444;
            text-align: center;
            width: 100%;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
        }
        .theme-switcher {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 120px;
            margin-top: 20px;
            flex-shrink: 0;
        }
        .theme-btn {
            padding: 12px 8px;
            border: none;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: bold;
            width: 100%;
        }
        .theme-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .theme-btn.active {
            position: relative;
            animation: pulse 1.5s infinite ease-in-out;
            padding-left: 36px;
        }
        .theme-btn.active::before {
            content: "☞";
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 2px #000;
            font-family: "幼圆";
        }
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
            50% { transform: scale(1.02); box-shadow: 0 4px 14px rgba(0,0,0,0.2); }
            100% { transform: scale(1); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        }

        .container {
            flex: 1;
            padding: 30px;
            border-radius: 16px;
            background: #fff;
            overflow: hidden; /* 确保容器本身不滚动，滚动由内部wrapper控制 */
        }

        /* 导航菜单 */
        .nav {
            justify-content: center;
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 10px;
            flex-wrap: wrap;
        }
        .nav li a {
            display: block;
            padding: 12px 20px;
            border-radius: 8px;
            color: #fff;
            font-weight: bold;
            transition: all 0.2s ease;
        }
        .nav li a:hover {
            transform: translateY(-2px);
        }
        .nav li a.active {
            box-shadow: 0 0 0 3px rgba(255,255,255,0.5);
        }

        /* 标题区域 */
        .title-with-images {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        .side-gif {
            width: 80px;
            border-radius: 50%;
        }
        h1 {
            font-size: 36px;
            margin: 20px 0;
            text-align: center;
            padding: 15px;
            border-radius: 12px;
        }

        /* ----- 课程表核心样式 ----- */
        /* 表格外层包裹器，用于横向滚动 */
        .table-wrapper {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch; /* 流畅滚动 */
            margin-top: 10px;
            margin-bottom: -1px; /* 与底部按钮保持间距 */
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            background: transparent;
            /* 确保表格最小宽度，使滚动生效 */
            min-width: 800px; /* 根据实际列宽调整，确保窄屏时滚动 */
        }
        th, td {
            border: 1px solid #e5e7eb;
            text-align: center;
            padding: 8px 4px;
            position: relative;
        }
        th {
            background: #415fff;
            color: #fff;
            font-weight: normal;
        }
        th:first-child, td.time-block {
            width: 50px;
        }
        th:nth-child(2), td.lesson-index {
            width: 40px;
        }
        th:nth-child(n+3), td.course-cell {
            width: 120px;
        }
        .time-block {
            background: #f8f9fa;
            font-weight: bold;
            font-size: 16px;
        }
        .morning { background: #e6f7ff; }
        .afternoon { background: #f6ffed; }
        .evening { background: #fff7e6; }

        .course-cell {
            height: 70px !important;
            cursor: default;
            transition: background-color 0.2s;
            vertical-align: top;
            padding: 4px;
        }
        .course-cell.editable {
            cursor: pointer;
        }
        .course-cell:hover {
            background-color: #f0f7ff;
        }
        .course-cell.selected {
            background-color: #b8d4ff !important;
            outline: 2px solid #415fff;
            outline-offset: -2px;
        }
        .course-cell.merge-hover {
            background-color: #c0f0c0 !important;
            outline: 2px solid #2e7d32;
            outline-offset: -2px;
        }
        .course-cell.copy-hover {
            background-color: #fff3cd !important;
            outline: 2px solid #fd7e14;
            outline-offset: -2px;
        }
        .course-cell.merged {
            display: none;
        }

        /* 课程类型颜色样式 */
        .course-content {
            border-radius: 6px;
            padding: 6px 4px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            text-align: left;
            font-size: 13px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            height: 100%;
            max-height: 280px;
            overflow-y: auto;
            word-break: break-word;
        }
        .course-content.type-none { background: #dbeafe; }
        .course-content.type-none .course-name { color: #1e3a8a; }
        .course-content.type-none .course-location-teacher { border-top-color: #a5c0fa; }
        .course-content.type-required-major { background: #ffe485; }
        .course-content.type-required-major .course-name { color: #78350f; }
        .course-content.type-required-major .course-location-teacher { border-top-color: #fbbf24; }
        .course-content.type-elective-major { background: #bae6fd; }
        .course-content.type-elective-major .course-name { color: #0c4a6e; }
        .course-content.type-elective-major .course-location-teacher { border-top-color: #38bdf8; }
        .course-content.type-required-public { background: #fed7aa; }
        .course-content.type-required-public .course-name { color: #9a3412; }
        .course-content.type-required-public .course-location-teacher { border-top-color: #fb923c; }
        .course-content.type-elective-public { background: #bfdbfe; }
        .course-content.type-elective-public .course-name { color: #1e40af; }
        .course-content.type-elective-public .course-location-teacher { border-top-color: #60a5fa; }
        .course-content.type-pe { background: #bbf7d0; }
        .course-content.type-pe .course-name { color: #14532d; }
        .course-content.type-pe .course-location-teacher { border-top-color: #4ade80; }
        .course-content.type-extra { background: #fbcfe8; }
        .course-content.type-extra .course-name { color: #831843; }
        .course-content.type-extra .course-location-teacher { border-top-color: #f472b6; }

        .course-type-tag {
            font-size: 10px;
            padding: 1px 4px;
            border-radius: 3px;
            margin-left: 4px;
            color: white;
            vertical-align: middle;
        }
        .tag-none { display: none; }
        .tag-required-major { background: #78350f; }
        .tag-elective-major { background: #0c4a6e; }
        .tag-required-public { background: #9a3412; }
        .tag-elective-public { background: #1e40af; }
        .tag-pe { background: #14532d; }
        .tag-extra { background: #831843; }

        .course-location-teacher {
            display: flex;
            align-items: center;
            gap: 4px;
            color: #2c3e50;
            font-size: 12px;
            line-height: 1.4;
            word-break: break-word;
            border-top: 1px dashed #a5c0fa;
            padding-top: 4px;
        }
        .course-location-teacher::before {
            content: ">";
            margin-right: 2px;
            opacity: 0.8;
        }
        .empty { background: #f9f9fc; }
        .empty .course-content { display: none; }

        /* 底部按钮组 (基础样式) */
        .table-footer {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 10px;
            border-top: 1px solid #e5e7eb;
            flex-wrap: wrap;
            margin-bottom: 30px;

        }
        .action-btn {
            padding: 10px 30px;
            border: none;
            border-radius: 40px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }
        .edit-btn { background: #415fff; color: white; }
        .edit-btn:hover { background: #2e4ad6; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(65,95,255,0.3); }
        .save-all { background: #415fff; color: white; }
        .save-all:hover { background: #2e4ad6; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(65,95,255,0.3); }
        .clear-all { background: #ffffff; color: #4b5563; border:1px solid #d1d5db; }
        .clear-all:hover { background: #f3f4f6; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
        .exit-edit { background: #f97316; color: white; }
        .exit-edit:hover { background: #ea580c; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(249,115,22,0.3); }
        .delete-btn, .split-btn { background: #ffffff; color: #4b5563; border:1px solid #d1d5db; }
        .delete-btn:not(:disabled):hover { background: #fee2e2; border-color:#f87171; color:#b91c1c; transform:translateY(-2px); box-shadow:0 6px 12px rgba(239,68,68,0.2); }
        .split-btn:not(:disabled):hover { background: #e0f2e0; border-color:#2e7d32; color:#1b5e20; transform:translateY(-2px); box-shadow:0 6px 12px rgba(46,125,50,0.2); }
        .delete-btn:disabled, .split-btn:disabled { opacity:0.4; cursor:not-allowed; transform:none; box-shadow:none; }

        /* 浮动编辑面板 */
        .float-edit-panel {
            position: fixed;
            background: white;
            border: 2px solid #415fff;
            border-radius: 10px;
            padding: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 1000;
            width: 260px;
            display: none;
            flex-direction: column;
            gap: 12px;
        }
        .float-edit-panel .field {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .float-edit-panel label {
            font-size: 12px;
            color: #4b5563;
            font-weight: 500;
        }
        .float-edit-panel input,
        .float-edit-panel select {
            padding: 6px 8px;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            font-size: 13px;
            outline: none;
        }
        .float-edit-panel input:focus,
        .float-edit-panel select:focus {
            border-color: #415fff;
            box-shadow: 0 0 0 2px rgba(65,95,255,0.2);
        }
        .panel-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 8px;
        }
        .panel-save { background: #415fff; color: white; padding:5px 14px; border:none; border-radius:20px; font-size:12px; font-weight:500; cursor:pointer; }
        .panel-cancel { background: #f1f5f9; color: #334155; padding:5px 14px; border:none; border-radius:20px; font-size:12px; font-weight:500; cursor:pointer; }

        /* 操作弹窗 */
        .action-modal, .confirm-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 2000;
            display: none;
            flex-direction: column;
            gap: 16px;
            min-width: 280px;
        }
        .modal-title { font-size:16px; font-weight:600; color:#333; text-align:center; }
        .modal-buttons { display:flex; gap:10px; justify-content:center; }
        .modal-btn { padding:8px 20px; border:none; border-radius:20px; font-size:14px; font-weight:500; cursor:pointer; transition:all 0.2s; }
        .modal-btn.merge { background:#2e7d32; color:white; }
        .modal-btn.merge:hover { background:#1b5e20; transform:translateY(-2px); }
        .modal-btn.copy { background:#415fff; color:white; }
        .modal-btn.copy:hover { background:#2e4ad6; transform:translateY(-2px); }
        .modal-btn.cancel { background:#f1f5f9; color:#4b5563; border:1px solid #d1d5db; }
        .modal-btn.cancel:hover { background:#e2e8f0; transform:translateY(-2px); }
        .modal-overlay {
            position: fixed;
            top: 0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.5);
            z-index: 1999;
            display: none;
            pointer-events: none;
        }
        .modal-overlay.show { pointer-events: auto; }

        /* 像素字体 */
        @font-face {
            font-family: "Minecraft AE";
            src: url("../fonts/Minecraft AE(ch).ttf") format("truetype");
        }

        /* ---------- 返回按钮基础样式 (仿校历) ---------- */
        .back-btn {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.2s ease;
            color: #fff;
            margin: 0 5px;
            border: none;
            cursor: pointer;
        }
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        /* ========== 四个主题样式 (完整包含所有按钮) ========== */

        /* ---- 卡通童趣 theme-original ---- */
        body.theme-original {
            background-color: #fff9e6;
            color: #333;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffb6c1' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
        }
        .theme-original .container {
            background: #fff;
            border: 4px solid #ff9eaa;
            box-shadow: 0 0 0 8px rgba(255,158,170,0.1);
        }
        .theme-original h1 {
            color: #ff6b8b;
            text-shadow: 2px 2px 0 #ffe0e7;
        }
        .theme-original .nav {
            background-color: #87ceeb;
            border: 3px solid #4fc3f7;
        }
        .theme-original .nav li a {
            background-color: #4fc3f7;
            box-shadow: 0 4px 0 #d45e7a;
        }
        .theme-original .nav li a:hover {
            background-color: #2196f3;
        }
        .theme-original .nav li a.active {
            background-color: #ff6b8b;
        }
        .theme-original th {
            background: #87ceeb;
            color: #333;
        }
        .theme-original .time-block {
            background: #ffd9e6;
        }
        .theme-original .morning { background: #fff2f5; }
        .theme-original .afternoon { background: #fff0e7; }
        .theme-original .evening { background: #e6f3ff; }

        /* 按钮主题化 */
        .theme-original .action-btn.edit-btn,
        .theme-original .action-btn.save-all {
            background: #ff6b8b;
            box-shadow: 0 4px 0 #d45e7a;
        }
        .theme-original .action-btn.exit-edit {
            background: #ffaa5e;
            box-shadow: 0 4px 0 #cc8844;
        }
        .theme-original .action-btn.delete-btn {
            background: #ffe0e7;
            color: #b34b6b;
            border: 1px solid #ff9eaa;
        }
        .theme-original .action-btn.delete-btn:not(:disabled):hover {
            background: #ffc0d0;
            border-color: #ff6b8b;
            color: #b34b6b;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(255,107,139,0.3);
        }
        .theme-original .action-btn.split-btn {
            background: #e0f0ff;
            color: #2d7a9e;
            border: 1px solid #87ceeb;
        }
        .theme-original .action-btn.split-btn:not(:disabled):hover {
            background: #c0e0ff;
            border-color: #4fc3f7;
            color: #1a5a7a;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(79,195,247,0.3);
        }
        .theme-original .action-btn.clear-all {
            background: #fff5e6;
            color: #cc7a4d;
            border: 1px solid #ffb27a;
        }
        .theme-original .action-btn.clear-all:hover {
            background: #ffe5cc;
            border-color: #ff8c5a;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(255,140,90,0.2);
        }
        /* 返回按钮样式 */
        .theme-original .back-btn {
            background-color: #ff6b8b;
            box-shadow: 0 4px 0 #d45e7a;
        }
        .theme-original .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #d45e7a;
        }
        .theme-original .float-edit-panel { border-color: #ff9eaa; }
        .theme-original .modal-btn.copy { background: #ff6b8b; }
        .theme-original .modal-btn.merge { background: #87ceeb; color: #000; }

        /* ---- 糖果缤纷 theme-candy ---- */
        body.theme-candy {
            background-color: #fff0f5;
            color: #555;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffc0cb' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .theme-candy .container {
            background: linear-gradient(145deg,#fff 0,#fff9fb 100%);
            border: 5px solid #ff85a2;
            border-radius: 24px;
            box-shadow: 0 0 0 10px rgba(255,133,162,0.1), 0 8px 24px rgba(0,0,0,0.08);
        }
        .theme-candy h1 {
            background: linear-gradient(90deg,#ff6b8b,#ff99cc,#87cefa);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .theme-candy .nav {
            background: linear-gradient(90deg,#87cefa,#99ddff);
            border: 3px solid #66c2ff;
            border-radius: 50px;
        }
        .theme-candy .nav li a {
            background: linear-gradient(145deg,#66c2ff,#4fc3f7);
            border-radius: 50px;
        }
        .theme-candy .nav li a.active {
            background: linear-gradient(145deg,#ff6b8b,#ff85a2);
            box-shadow: 0 6px 12px rgba(255,107,139,0.3);
        }

        .theme-candy th {
            background: linear-gradient(145deg,#ff99cc,#ff85a2);
            color: white;
        }
        .theme-candy .time-block { background: #fff0f5; }
        .theme-candy .morning { background: #ffeef8; }
        .theme-candy .afternoon { background: #fff3e6; }
        .theme-candy .evening { background: #e6f0ff; }

        .theme-candy .action-btn.edit-btn,
        .theme-candy .action-btn.save-all {
            background: linear-gradient(145deg,#ff85a2,#ff6b8b);
            box-shadow: 0 4px 0 #cc6a7a;
        }
        .theme-candy .action-btn.exit-edit {
            background: linear-gradient(145deg,#ffb07a,#ff8c5a);
            box-shadow: 0 4px 0 #cc6a4a;
        }
        .theme-candy .action-btn.delete-btn {
            background: #ffe0f0;
            color: #b34b7a;
            border: 1px solid #ff99cc;
        }
        .theme-candy .action-btn.delete-btn:not(:disabled):hover {
            background: #ffc0e0;
            border-color: #ff6b9e;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(255,107,158,0.3);
        }
        .theme-candy .action-btn.split-btn {
            background: #e0f0ff;
            color: #2d7a9e;
            border: 1px solid #87cefa;
        }
        .theme-candy .action-btn.split-btn:not(:disabled):hover {
            background: #c0e0ff;
            border-color: #4fc3f7;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(79,195,247,0.3);
        }
        .theme-candy .action-btn.clear-all {
            background: #fff5f0;
            color: #cc7a6b;
            border: 1px solid #ffb0a0;
        }
        .theme-candy .action-btn.clear-all:hover {
            background: #ffe5e0;
            border-color: #ff8a7a;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(255,138,122,0.2);
        }
        /* 返回按钮样式 */
        .theme-candy .back-btn {
            background: linear-gradient(145deg,#ff6b8b,#ff85a2);
            border: 2px solid transparent;
            border-radius: 50px;
            box-shadow: 0 4px 0 #cc6a7a;
        }
        .theme-candy .back-btn:hover {
            background: linear-gradient(145deg,#ff85a2,#ff6b8b);
            transform: translateY(-2px) scale(1.05);
            border-color: #fff;
            box-shadow: 0 6px 0 #cc6a7a;
        }
        .theme-candy .float-edit-panel { border-color: #ff85a2; border-radius: 20px; }
        .theme-candy .modal-btn.copy { background: #ff85a2; }
        .theme-candy .modal-btn.merge { background: #87cefa; color: #000; }

        /* ---- 森林治愈 theme-forest ---- */
        body.theme-forest {
            background-color: #f5f9f0;
            color: #4a5a45;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23a8d08d' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
        }
        .theme-forest .container {
            background: #fff;
            border: 4px solid #c19a6b;
            box-shadow: 0 0 0 8px rgba(193,154,107,0.1);
        }
        .theme-forest h1 { color: #6b8e23; text-shadow: 2px 2px 0 #e8f0d6; }
        .theme-forest .nav { background-color: #8fbc8f; border: 3px solid #6f9e6f; }
        .theme-forest .nav li a { background-color: #7ccd7c; }
        .theme-forest th { background: #8fbc8f; color: #2d4a2d; }
        .theme-forest .time-block { background: #e0d6c0; }
        .theme-forest .morning { background: #f0f7e6; }
        .theme-forest .afternoon { background: #f5ede0; }
        .theme-forest .evening { background: #e0e8d6; }

        .theme-forest .action-btn.edit-btn,
        .theme-forest .action-btn.save-all {
            background: #6b8e23;
            box-shadow: 0 4px 0 #4f7317;
        }
        .theme-forest .action-btn.exit-edit {
            background: #b78a5a;
            box-shadow: 0 4px 0 #8e6b45;
        }
        .theme-forest .action-btn.delete-btn {
            background: #ecd9c6;
            color: #8b5a2b;
            border: 1px solid #c19a6b;
        }
        .theme-forest .action-btn.delete-btn:not(:disabled):hover {
            background: #e0c4a8;
            border-color: #a5774a;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(165,119,74,0.3);
        }
        .theme-forest .action-btn.split-btn {
            background: #d0e0b0;
            color: #3d6b2d;
            border: 1px solid #8fbc8f;
        }
        .theme-forest .action-btn.split-btn:not(:disabled):hover {
            background: #b8d090;
            border-color: #6f9e6f;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(111,158,111,0.3);
        }
        .theme-forest .action-btn.clear-all {
            background: #e8e0d0;
            color: #6b4a2a;
            border: 1px solid #c0a080;
        }
        .theme-forest .action-btn.clear-all:hover {
            background: #d8c8b0;
            border-color: #a08060;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(160,128,96,0.2);
        }
        .theme-forest .nav li a.active {
            background-color: #c19a6b;
        }

        /* 返回按钮样式 */
        .theme-forest .back-btn {
            background-color: #6b8e23;
            box-shadow: 0 4px 0 #4f7317;
            border: 2px solid #4f7317;
        }
        .theme-forest .back-btn:hover {
            background-color: #4f7317;
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #4f7317;
        }
        .theme-forest .float-edit-panel { border-color: #6b8e23; }
        .theme-forest .modal-btn.copy { background: #6b8e23; }
        .theme-forest .modal-btn.merge { background: #c19a6b; color: #fff; }

        /* ---- 复古像素 theme-pixel (使用Minecraft字体) ---- */
        body.theme-pixel {
            font-family: "Minecraft AE", "幼圆", "Comic Sans MS", monospace;
            background-color: #e0e0e0;
            color: #2a2a2a;
            background-image: url("data:image/svg+xml,%3Csvg width='64' height='64' viewBox='0 0 64 64' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M8 16c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8zm0-2c3.314 0 6-2.686 6-6s-2.686-6-6-6-6 2.686-6 6 2.686 6 6 6zm33.414-6l5.95-5.95L45.95.636 40 6.586 34.05.636 32.636 2.05 38.586 8l-5.95 5.95 1.414 1.414L40 9.414l5.95 5.95 1.414-1.414L41.414 8zM40 48c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8zm0-2c3.314 0 6-2.686 6-6s-2.686-6-6-6-6 2.686-6 6 2.686 6 6 6zM9.414 40l5.95-5.95-1.414-1.414L8 38.586l-5.95-5.95L.636 34.05 6.586 40l-5.95 5.95 1.414 1.414L8 41.414l5.95 5.95 1.414-1.414L9.414 40z' fill='%23969696' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
            image-rendering: pixelated;
            -webkit-font-smoothing: none;
        }
        .theme-pixel .container {
            background: #c69c6d;
            background-image: url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h8v8H0V0zm8 8h8v8H8V8zM0 8h8v8H0V8zm8 0h8v8H8V8z' fill='%23966c42' fill-opacity='0.2' fill-rule='evenodd'/%3E%3C/svg%3E");
            border-radius: 0;
            border: 6px solid #8b5a2b;
            box-shadow: 8px 8px 0 #4a3218;
        }
        .theme-pixel h1 {
            color: #fff;
            font-size: 24px;
            text-shadow: 3px 3px 0 #000;
            background: #808080;
            background-image: url("data:image/svg+xml,%3Csvg width='4' height='4' viewBox='0 0 4 4' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h4v4H0V0zm1 1h2v2H1V1zm2 0h2v2H3V1zm-2 2h2v2H1V3zm2 0h2v2H3V3z' fill='%23696969' fill-opacity='0.3' fill-rule='evenodd'/%3E%3C/svg%3E");
            padding: 10px;
            border: 4px solid #000;
            max-width: 90%;
            margin-left: auto;
            margin-right: auto;
            letter-spacing: 2px;
            -webkit-font-smoothing: none;
            -moz-osx-font-smoothing: grayscale;
        }
        .theme-pixel .nav {
            background: #4040a0;
            border: 4px solid #000;
            border-radius: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='8' height='8' viewBox='0 0 8 8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h8v8H0V0zm1 1h6v6H1V1z' fill='%23303080' fill-opacity='0.3' fill-rule='evenodd'/%3E%3C/svg%3E");
        }
        .theme-pixel .nav li a {
            border-radius: 0;
            background-color: #6060c0;
            border: 4px solid #000;
            text-shadow: 2px 2px 0 #000;
            box-shadow: 4px 4px 0 #202080;
            color: #fff;
            -webkit-font-smoothing: none;
            -moz-osx-font-smoothing: grayscale;
        }
        .theme-pixel .nav li a.active {
            background-color: #ff3030;
            border: 4px solid #000;
            box-shadow: 4px 4px 0 #a01010;
        }

        .theme-pixel th {
            background: #6060c0;
            border: 2px solid #000;
            color: #fff;
            text-shadow: 2px 2px 0 #000;
            font-weight: normal;
        }
        .theme-pixel td {
            border: 2px solid #000;
        }
        .theme-pixel .time-block { background: #a0a0a0; color: #fff; text-shadow: 2px 2px 0 #000; }
        .theme-pixel .morning { background: #b0b0b0; }
        .theme-pixel .afternoon { background: #909090; }
        .theme-pixel .evening { background: #707070; }

        /* 像素按钮：统一使用像素风格边框和阴影 */
        .theme-pixel .action-btn {
            border-radius: 0;
            border: 3px solid #000;
            box-shadow: 4px 4px 0 #2a2a2a;
            font-family: "Minecraft AE", monospace;
            -webkit-font-smoothing: none;
            text-shadow: 1px 1px 0 #000;
            transition: none;
        }
        .theme-pixel .action-btn:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 #2a2a2a;
        }
        .theme-pixel .action-btn.edit-btn { background: #60a060; }
        .theme-pixel .action-btn.save-all { background: #6060c0; }
        .theme-pixel .action-btn.exit-edit { background: #c06060; }
        .theme-pixel .action-btn.delete-btn {
            background: #c06060;
            color: white;
            border-color: #8b3a3a;
        }
        .theme-pixel .action-btn.split-btn {
            background: #60a060;
            color: white;
            border-color: #3a8b3a;
        }
        .theme-pixel .action-btn.clear-all {
            background: #a0a0a0;
            color: white;
            border-color: #6a6a6a;
        }
        .theme-pixel .action-btn:disabled {
            opacity: 0.5;
            filter: grayscale(0.5);
            box-shadow: 2px 2px 0 #2a2a2a;
            transform: translate(2px, 2px);
        }
        .theme-pixel .action-btn:not(:disabled):hover {
            background-color: #808080;
        }
        /* 返回按钮样式 */
        .theme-pixel .back-btn {
            background-color: #507050;
            border: 4px solid #000;
            border-radius: 0;
            color: #fff;
            text-shadow: 2px 2px 0 #000;
            box-shadow: 4px 4px 0 #2a3a2a;
            font-family: "Minecraft AE", monospace;
            -webkit-font-smoothing: none;
            -moz-osx-font-smoothing: grayscale;
        }
        .theme-pixel .back-btn:hover {
            background-color: #60a060;
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 #2a3a2a;
        }
        .theme-pixel .float-edit-panel {
            border-radius: 0;
            border: 4px solid #000;
            background: #c69c6d;
            box-shadow: 8px 8px 0 #4a3218;
        }
        .theme-pixel .float-edit-panel input,
        .theme-pixel .float-edit-panel select {
            border-radius: 0;
            border: 2px solid #000;
            background: #efe3d0;
        }
        .theme-pixel .modal-btn {
            border-radius: 0;
            border: 2px solid #000;
            font-family: "Minecraft AE", monospace;
            text-shadow: 1px 1px 0 #000;
        }
        .theme-pixel .modal-btn.copy { background: #60a060; }
        .theme-pixel .modal-btn.merge { background: #6060c0; }
        .theme-pixel .modal-btn.cancel { background: #a0a0a0; }

        /* 主题按钮配色 (不变) */
        #btn-original { background-color: #ff6b8b; }
        #btn-candy { background: linear-gradient(90deg,#ff6b8b,#ff99cc,#87cefa); }
        #btn-forest { background-color: #6b8e23; }
        #btn-pixel { background-color: #8b5a2b; font-family: "Minecraft AE", monospace; font-size:13px; text-shadow:1px 1px 0 #000; -webkit-font-smoothing:none; }

        /* ---------- 移动端适配 (仅表格滚动) ---------- */
        @media (max-width: 768px) {
            .page-layout { flex-direction: column; gap:15px; padding:10px; }
            .theme-switcher { width:100%; flex-direction: row; flex-wrap: wrap; justify-content: center; gap:8px; margin-top:0; }
            .theme-btn { padding:10px 15px; font-size:12px; width:auto; }
            .container {
                width:100%;
                padding:15px;
                border-width:3px !important;
                overflow: visible; /* 确保容器不滚动 */
            }
            h1 { font-size:28px; }
            .nav { flex-direction: column; gap:8px; }
            .nav li a { padding:8px; font-size:14px; text-align:center; }
            .side-gif { width:40px; }
            th, td { font-size:12px; padding:4px 2px; }
            .course-content { font-size:11px; padding:3px; }
            .action-btn { padding:8px 16px; font-size:14px; }
            .float-edit-panel { width:220px; }
            .theme-pixel .container { box-shadow:4px 4px 0 #4a3218; }
            /* 返回按钮在移动端调整大小 */
            .back-btn { padding:6px 12px; font-size:14px; }
            /* 表格滚动条样式 */
            .table-wrapper {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                margin-bottom: -1px;
            }
        }
        @media (min-width:601px) and (max-width:768px) { .nav { flex-direction:row; } }

        /*----- 底部校徽样式 -----*/
        .svg-image {
            width: 280px;          /* 相对父容器宽度 */
            max-width: 250px;    /* 最大宽度限制，避免过大 */
            height: auto;        /* 保持比例 */
            }
            @media (max-width: 768px){
            .svg-image {
            width: 60%;          /* 相对父容器宽度 */
            max-width: 150px;    /* 最大宽度限制，避免过大 */
            height: auto;        /* 保持比例 */
            }
        }
.svg-image {
    max-width: 100%;
    height: auto;
    display: inline-block;
    transition: border 0.2s ease, box-shadow 0.2s ease;
}
.theme-original .svg-image {
    border: 4px dashed #ff6b8b;
    border-radius: 16px;
}
.theme-candy .svg-image {
    border: 4px solid #ff85a2;
    border-radius: 20px;
    box-shadow: 0 4px 12px rgba(255, 133, 162, 0.2);
}
.theme-forest .svg-image {
    border: 4px solid #6b8e23;
    border-radius: 8px;
}      
        .theme-pixel .svg-image {
    border: 4px solid #000;
    border-radius: 0;
    box-shadow: 4px 4px 0 #2a3a2a;
}
        /*----- 标题gif样式 -----*/
        .theme-candy .side-gif {
            border: 4px solid #ffdd55;
            box-shadow: 0 0 0 4px rgba(255,221,85,0.2);
        }
        .theme-forest .side-gif {
            border: 3px solid #c19a6b;
        }
        .theme-pixel .side-gif {
            border-radius: 0;
            border: 4px solid #ffaa00;
            box-shadow: 4px 4px 0 #000;
            padding: 4px;
            background-color: #f0f0f0;
            image-rendering: pixelated;
        }
        @media (max-width: 768px){
            .side-gif {
                width: 50px;
            }
            .theme-pixel .side-gif {
                border-width: 3px;
                box-shadow: 3px 3px 0 #000;
            }
            .title-with-images {
                gap: 15px;
            }
        }

                    
    </style>
</head>
<body class="theme-original">
    <div class="page-layout">
        <!-- 主题切换器 (与BNUindex完全一致) -->
        <div class="theme-switcher">
            <div class="theme-title">主题选择</div>
            <button class="theme-btn" id="btn-original">卡通童趣</button>
            <button class="theme-btn" id="btn-candy">糖果缤纷</button>
            <button class="theme-btn" id="btn-forest">森林治愈</button>
            <button class="theme-btn" id="btn-pixel">复古像素</button>
        </div>

        <!-- 主要内容容器 (课程表) -->
        <div class="container">
            <!-- 导航 (与BNUindex相同，BNU高亮) -->
            <ul class="nav">
                <li><a href="../index.html">首页</a></li>
                <li><a href="../gallery.html">相册</a></li>
                <li><a href="../videos.html">影集</a></li>
                <li><a href="#">故事</a></li>
                <li><a href="../maptest.html">地图</a></li>
                <li><a href="BNUindex.html" class="active">BNU</a></li>
                <li><a href="../more/more_index.html">更多</a></li>
            </ul>

            <!-- 标题区 (带小熊装饰) -->
            <div class="title-with-images">
                <img src="images/pigsleepy.webp" alt="小熊" class="side-gif" onerror="this.style.display='none'">
                <h1>BNU - 课程表test</h1>
                <img src="images/pigsleep.webp" alt="小熊" class="side-gif" onerror="this.style.display='none'">
            </div>

            <!-- 返回按钮 (仿校历) -->
            <div style="margin-bottom: 15px;">
                <a href="BNUindex.html" class="back-btn">← 返回</a>
            </div>
            <div style="text-align: center; color: black;">
            <p>点击“编辑”按钮进入编辑模式</b></p>
            <p>在编辑模式下：</b></p>
            <p>双击单元格添加课程</b></p>
            <p>单击单元格选中该单元格</b></p>
            <p>选中单元格后，可以再单击其他单元格进行合并/复制操作</b></p>
            </div>
            

            <!-- 课程表本体：用table-wrapper包裹以实现横向滚动 -->
            <div class="table-wrapper">
                <table id="courseTable">
                    <thead>
                        <tr>
                            <th>时段</th>
                            <th>节次</th>
                            <th>周一</th>
                            <th>周二</th>
                            <th>周三</th>
                            <th>周四</th>
                            <th>周五</th>
                            <th>周六</th>
                            <th>周日</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- 上午 1-4 节 -->
                        <tr class="morning">
                            <td rowspan="4" class="time-block">上午</td>
                            <td>1</td>
                            <td class="course-cell" data-name="高等数学" data-location="一教101" data-teacher="张老师" data-type="required-major">
                                <div class="course-content type-required-major">
                                    <div class="course-name">高等数学<span class="course-type-tag tag-required-major">专必课</span></div>
                                    <div class="course-location-teacher">一教101 丨 张老师</div>
                                </div>
                            </td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                        </tr>
                        <tr class="morning">
                            <td>2</td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                        </tr>
                        <tr class="morning">
                            <td>3</td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                        </tr>
                        <tr class="morning">
                            <td>4</td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                        </tr>

                        <!-- 下午 5-8 节 -->
                        <tr class="afternoon">
                            <td rowspan="4" class="time-block">下午</td>
                            <td>5</td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                        </tr>
                        <tr class="afternoon">
                            <td>6</td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                        </tr>
                        <tr class="afternoon">
                            <td>7</td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                        </tr>
                        <tr class="afternoon">
                            <td>8</td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                        </tr>

                        <!-- 晚上 9-12 节 -->
                        <tr class="evening">
                            <td rowspan="4" class="time-block">晚上</td>
                            <td>9</td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                        </tr>
                        <tr class="evening">
                            <td>10</td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                        </tr>
                        <tr class="evening">
                            <td>11</td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                        </tr>
                        <tr class="evening">
                            <td>12</td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                            <td class="course-cell empty" data-name="" data-location="" data-teacher="" data-type="none"></td>
                        </tr>
                    </tbody>
                </table>
            </div> <!-- 结束 table-wrapper -->

            <!-- 底部按钮组 (动态渲染，初始为编辑按钮) -->
            <div class="table-footer" id="footerButtons">
                <button class="action-btn edit-btn" id="editModeBtn">编辑</button>
            </div>

            <div style="text-align: center;">
                <a href="https://www.bnu.edu.cn/" target="_blank">
                <img src="images/BNUlogo.svg" alt="BNU矢量图" class="svg-image" >
                </a>
            </div>
            
        </div>

        
    </div>

    <!-- 浮动编辑面板 (课程编辑) -->
    <div class="float-edit-panel" id="floatEditPanel">
        <div class="field">
            <label>课程名称</label>
            <input type="text" id="editName" placeholder="例如：教育学原理">
        </div>
        <div class="field">
            <label>课程类型</label>
            <select id="editType">
                <option value="none">无</option>
                <option value="required-major">专必课</option>
                <option value="elective-major">专选课</option>
                <option value="required-public">公必课</option>
                <option value="elective-public">公选课</option>
                <option value="pe">体育课</option>
                <option value="extra">额外</option>
            </select>
        </div>
        <div class="field">
            <label>地点</label>
            <input type="text" id="editLocation" placeholder="例如：教七203">
        </div>
        <div class="field">
            <label>教师</label>
            <input type="text" id="editTeacher" placeholder="例如：康永久">
        </div>
        <div class="panel-buttons">
            <button class="modal-btn copy" id="panelSave">保存</button>
            <button class="modal-btn cancel" id="panelCancel">取消</button>
        </div>
    </div>

    <!-- 操作选择弹窗 (合并/复制) -->
    <div class="action-modal" id="actionModal">
        <div class="modal-title">选择你要进行的操作</div>
        <div class="modal-buttons">
            <button class="modal-btn merge" id="modalMergeBtn">合并</button>
            <button class="modal-btn copy" id="modalCopyBtn">复制</button>
            <button class="modal-btn cancel" id="modalCancelBtn">取消</button>
        </div>
    </div>

    <!-- 复制确认弹窗 -->
    <div class="confirm-modal" id="confirmModal">
        <div class="modal-title">确定要复制课程信息吗？</div>
        <div class="modal-buttons">
            <button class="modal-btn copy" id="confirmCopyBtn">确定</button>
            <button class="modal-btn cancel" id="confirmCancelBtn">取消</button>
        </div>
    </div>

    

    <!-- 遮罩层 -->
    <div class="modal-overlay" id="modalOverlay"></div>

    <script>
        (function() {
            // ========== 课程类型配置 ==========
            const courseTypeConfig = {
                'none': { name: '无', bgColor: '#dbeafe', textColor: '#1e3a8a', borderColor: '#a5c0fa', tagClass: 'tag-none' },
                'required-major': { name: '专必课', bgColor: '#ffe485', textColor: '#78350f', borderColor: '#fbbf24', tagClass: 'tag-required-major' },
                'elective-major': { name: '专选课', bgColor: '#bae6fd', textColor: '#0c4a6e', borderColor: '#38bdf8', tagClass: 'tag-elective-major' },
                'required-public': { name: '公必课', bgColor: '#fed7aa', textColor: '#9a3412', borderColor: '#fb923c', tagClass: 'tag-required-public' },
                'elective-public': { name: '公选课', bgColor: '#bfdbfe', textColor: '#1e40af', borderColor: '#60a5fa', tagClass: 'tag-elective-public' },
                'pe': { name: '体育课', bgColor: '#bbf7d0', textColor: '#14532d', borderColor: '#4ade80', tagClass: 'tag-pe' },
                'extra': { name: '额外', bgColor: '#fbcfe8', textColor: '#831843', borderColor: '#f472b6', tagClass: 'tag-extra' }
            };

            // ========== 通用工具函数 ==========
            function escapeHtml(unsafe) {
                if (!unsafe) return unsafe;
                return unsafe.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
            }

            function updateCellDisplay(cell, name, location, teacher, type) {
                type = type || cell.dataset.type || 'none';
                if (!courseTypeConfig[type]) type = 'none';

                const oldContent = cell.querySelector('.course-content');
                if (oldContent) oldContent.remove();

                if (name) {
                    cell.classList.remove('empty');
                    const contentDiv = document.createElement('div');
                    contentDiv.className = `course-content type-${type}`;

                    let locationTeacher = '';
                    if (location && teacher) {
                        locationTeacher = `${escapeHtml(location)} 丨 ${escapeHtml(teacher)}`;
                    } else if (location) {
                        locationTeacher = `${escapeHtml(location)} 丨 —`;
                    } else if (teacher) {
                        locationTeacher = `— 丨 ${escapeHtml(teacher)}`;
                    } else {
                        locationTeacher = '— 丨 —';
                    }

                    let courseNameHtml = escapeHtml(name);
                    if (type !== 'none') {
                        courseNameHtml += `<span class="course-type-tag ${courseTypeConfig[type].tagClass}">${courseTypeConfig[type].name}</span>`;
                    }

                    contentDiv.innerHTML = `
                        <div class="course-name" style="color: ${courseTypeConfig[type].textColor}">${courseNameHtml}</div>
                        <div class="course-location-teacher" style="border-top-color: ${courseTypeConfig[type].borderColor}">${locationTeacher}</div>
                    `;
                    cell.appendChild(contentDiv);
                } else {
                    cell.classList.add('empty');
                }

                cell.dataset.type = type;
            }

            // 初始化单元格元数据 (weekday, lesson, session等)
            function initMetadata() {
                const cells = document.querySelectorAll('.course-cell');
                cells.forEach(cell => {
                    const tr = cell.closest('tr');
                    if (!tr) return;
                    const cellsInRow = tr.cells;
                    let idx = -1;
                    for (let i = 0; i < cellsInRow.length; i++) {
                        if (cellsInRow[i] === cell) {
                            idx = i;
                            break;
                        }
                    }
                    if (idx === -1) return;

                    let baseOffset = (cellsInRow.length > 0 && cellsInRow[0].rowSpan > 1) ? 2 : 1;
                    const weekdayIndex = idx - baseOffset;
                    if (weekdayIndex >= 0 && weekdayIndex < 7) {
                        const weekdays = ['周一', '周二', '周三', '周四', '周五', '周六', '周日'];
                        cell.dataset.weekday = weekdays[weekdayIndex];
                    }

                    if (tr.classList.contains('morning')) {
                        cell.dataset.session = '上午';
                    } else if (tr.classList.contains('afternoon')) {
                        cell.dataset.session = '下午';
                    } else if (tr.classList.contains('evening')) {
                        cell.dataset.session = '晚上';
                    }

                    const lessonTd = cellsInRow[baseOffset - 1];
                    if (lessonTd) {
                        cell.dataset.lesson = lessonTd.textContent.trim();
                    }

                    if (!cell.dataset.mergeSize) cell.dataset.mergeSize = '1';
                    if (!cell.dataset.mergedBy) cell.dataset.mergedBy = '';
                    if (!cell.dataset.type) cell.dataset.type = 'none';
                });
            }

            // ========== 核心功能函数 ==========
            function copyCourseInfo(sourceCell, targetCell) {
                if (!sourceCell || !targetCell) return;
                targetCell.dataset.name = sourceCell.dataset.name || '';
                targetCell.dataset.location = sourceCell.dataset.location || '';
                targetCell.dataset.teacher = sourceCell.dataset.teacher || '';
                targetCell.dataset.type = sourceCell.dataset.type || 'none';
                updateCellDisplay(targetCell, targetCell.dataset.name, targetCell.dataset.location, targetCell.dataset.teacher, targetCell.dataset.type);
            }

            function canMerge(cellA, cellB) {
                if (!cellA || !cellB || cellA === cellB) return false;
                if (cellA.dataset.weekday !== cellB.dataset.weekday) return false;
                if (cellA.dataset.session !== cellB.dataset.session) return false;

                const lessonA = parseInt(cellA.dataset.lesson);
                const sizeA = parseInt(cellA.dataset.mergeSize);
                const lessonB = parseInt(cellB.dataset.lesson);
                const sizeB = parseInt(cellB.dataset.mergeSize);

                return (lessonA + sizeA === lessonB) || (lessonB + sizeB === lessonA);
            }

            function mergeCells(selected, target) {
                if (!canMerge(selected, target)) return;

                const lessonSel = parseInt(selected.dataset.lesson);
                const lessonTar = parseInt(target.dataset.lesson);
                let top, bottom;

                if (lessonSel < lessonTar) {
                    top = selected;
                    bottom = target;
                } else {
                    top = target;
                    bottom = selected;
                }

                if (selected === bottom) {
                    top.dataset.name = selected.dataset.name;
                    top.dataset.location = selected.dataset.location;
                    top.dataset.teacher = selected.dataset.teacher;
                    top.dataset.type = selected.dataset.type;
                    updateCellDisplay(top, top.dataset.name, top.dataset.location, top.dataset.teacher, top.dataset.type);
                }

                const newSize = parseInt(top.dataset.mergeSize) + parseInt(bottom.dataset.mergeSize);
                top.rowSpan = newSize;
                top.dataset.mergeSize = newSize;

                bottom.dataset.mergedBy = top.dataset.lesson + '-' + top.dataset.weekday;
                bottom.classList.add('merged');

                clearSelected();
                top.classList.add('selected');
                selectedCell = top;
                updateButtonStates();
            }

            function splitCell(cell) {
                const mergeSize = parseInt(cell.dataset.mergeSize);
                if (mergeSize <= 1) return;

                const lesson = parseInt(cell.dataset.lesson);
                const weekday = cell.dataset.weekday;
                const mergeKey = lesson + '-' + weekday;

                cell.rowSpan = 1;
                cell.dataset.mergeSize = '1';

                const mergedCells = document.querySelectorAll(`.course-cell[data-merged-by="${mergeKey}"]`);
                mergedCells.forEach(mergedCell => {
                    mergedCell.dataset.mergedBy = '';
                    mergedCell.classList.remove('merged');
                    mergedCell.dataset.mergeSize = '1';
                    mergedCell.dataset.name = '';
                    mergedCell.dataset.location = '';
                    mergedCell.dataset.teacher = '';
                    mergedCell.dataset.type = 'none';
                    updateCellDisplay(mergedCell, '', '', '', 'none');
                });

                initMetadata();
                updateButtonStates();
            }

            // ========== 状态管理 ==========
            let editingMode = false;
            let currentEditingCell = null;
            let selectedCell = null;
            let targetCell = null;

            function clearSelected() {
                if (selectedCell) selectedCell.classList.remove('selected');
                document.querySelectorAll('.course-cell').forEach(c => c.classList.remove('merge-hover', 'copy-hover'));
                selectedCell = null;
                updateButtonStates();
            }

            function hideEditPanel() {
                document.getElementById('floatEditPanel').style.display = 'none';
                currentEditingCell = null;
            }

            function updateButtonStates() {
                const deleteBtn = document.getElementById('deleteBtn');
                const splitBtn = document.getElementById('splitBtn');
                if (deleteBtn) deleteBtn.disabled = !(editingMode && selectedCell);
                if (splitBtn) splitBtn.disabled = !(editingMode && selectedCell && parseInt(selectedCell.dataset.mergeSize) > 1);
            }

            function clearCell(cell) {
                if (!cell) return;
                cell.dataset.name = '';
                cell.dataset.location = '';
                cell.dataset.teacher = '';
                cell.dataset.type = 'none';
                updateCellDisplay(cell, '', '', '', 'none');
                if (currentEditingCell === cell) hideEditPanel();
            }

            // ========== 底部按钮渲染 ==========
            function renderFooter() {
                const footer = document.getElementById('footerButtons');

                if (editingMode) {
                    footer.innerHTML = `
                        <button class="action-btn delete-btn" id="deleteBtn" disabled>删除选中</button>
                        <button class="action-btn split-btn" id="splitBtn" disabled>拆分</button>
                        <button class="action-btn clear-all" id="clearAllBtn">清空全部</button>
                        <button class="action-btn save-all" id="saveAllBtn">保存课表</button>
                        <button class="action-btn exit-edit" id="exitEditBtn">退出编辑</button>
                    `;

                    document.getElementById('deleteBtn').addEventListener('click', function() {
                        if (selectedCell) {
                            clearCell(selectedCell);
                            updateButtonStates();
                        }
                    });

                    document.getElementById('splitBtn').addEventListener('click', function() {
                        if (selectedCell && parseInt(selectedCell.dataset.mergeSize) > 1) {
                            splitCell(selectedCell);
                        }
                    });

                    document.getElementById('saveAllBtn').addEventListener('click', function() {
                        const cells = document.querySelectorAll('.course-cell');
                        const data = [];
                        cells.forEach(cell => {
                            data.push({
                                name: cell.dataset.name || '',
                                location: cell.dataset.location || '',
                                teacher: cell.dataset.teacher || '',
                                type: cell.dataset.type || 'none',
                                mergeSize: cell.dataset.mergeSize || '1',
                                lesson: cell.dataset.lesson,
                                weekday: cell.dataset.weekday,
                                mergedBy: cell.dataset.mergedBy || ''
                            });
                        });
                        localStorage.setItem('courseTableData', JSON.stringify(data));
                        alert('熊的课表已保存');
                    });

                    document.getElementById('clearAllBtn').addEventListener('click', function() {
                        if (confirm('确定要清空所有课程吗？')) {
                            document.querySelectorAll('.course-cell').forEach(cell => {
                                cell.dataset.name = '';
                                cell.dataset.location = '';
                                cell.dataset.teacher = '';
                                cell.dataset.type = 'none';
                                cell.dataset.mergedBy = '';
                                cell.classList.remove('merged');
                                cell.dataset.mergeSize = '1';
                                cell.rowSpan = 1;
                                updateCellDisplay(cell, '', '', '', 'none');
                            });
                            clearSelected();
                            hideEditPanel();
                        }
                    });

                    document.getElementById('exitEditBtn').addEventListener('click', function() {
                        editingMode = false;
                        clearSelected();
                        hideEditPanel();
                        hideAllModals();
                        document.querySelectorAll('.course-cell').forEach(c => c.classList.remove('editable', 'selected', 'merge-hover', 'copy-hover'));
                        renderFooter();
                    });

                    updateButtonStates();
                } else {
                    footer.innerHTML = `<button class="action-btn edit-btn" id="editModeBtn">编辑</button>`;
                    document.getElementById('editModeBtn').addEventListener('click', function() {
                        editingMode = true;
                        clearSelected();
                        document.querySelectorAll('.course-cell').forEach(c => c.classList.add('editable'));
                        renderFooter();
                    });
                }
            }

            // ========== 加载保存的数据 ==========
            function loadFromStorage() {
                const saved = localStorage.getItem('courseTableData');
                if (!saved) return;
                try {
                    const data = JSON.parse(saved);
                    const cells = document.querySelectorAll('.course-cell');
                    cells.forEach((cell, i) => {
                        if (data[i]) {
                            cell.dataset.name = data[i].name || '';
                            cell.dataset.location = data[i].location || '';
                            cell.dataset.teacher = data[i].teacher || '';
                            cell.dataset.type = data[i].type || 'none';
                            cell.dataset.mergeSize = data[i].mergeSize || '1';
                            cell.dataset.mergedBy = data[i].mergedBy || '';

                            if (data[i].mergedBy) {
                                cell.classList.add('merged');
                            } else {
                                cell.classList.remove('merged');
                            }

                            if (parseInt(cell.dataset.mergeSize) > 1) {
                                cell.rowSpan = parseInt(cell.dataset.mergeSize);
                            } else {
                                cell.rowSpan = 1;
                            }

                            updateCellDisplay(cell, cell.dataset.name, cell.dataset.location, cell.dataset.teacher, cell.dataset.type);
                        }
                    });
                } catch (e) {
                    console.error('加载课表数据失败:', e);
                }
            }

            // ========== 弹窗控制 ==========
            function showActionModal() {
                const overlay = document.getElementById('modalOverlay');
                overlay.style.display = 'block';
                overlay.classList.add('show');
                document.getElementById('actionModal').style.display = 'flex';
                document.getElementById('confirmModal').style.display = 'none';
                document.body.style.overflow = 'hidden';
            }

            function showConfirmModal() {
                const overlay = document.getElementById('modalOverlay');
                overlay.style.display = 'block';
                overlay.classList.add('show');
                document.getElementById('actionModal').style.display = 'none';
                document.getElementById('confirmModal').style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }

            function hideAllModals() {
                const overlay = document.getElementById('modalOverlay');
                overlay.style.display = 'none';
                overlay.classList.remove('show');
                document.getElementById('actionModal').style.display = 'none';
                document.getElementById('confirmModal').style.display = 'none';
                document.body.style.overflow = '';
                targetCell = null;
            }

            // ========== 事件监听初始化 ==========
            function initEventListeners() {
                const table = document.getElementById('courseTable');
                const floatEditPanel = document.getElementById('floatEditPanel');
                const overlay = document.getElementById('modalOverlay');

                // 单元格点击
                table.addEventListener('click', function(e) {
                    const cell = e.target.closest('.course-cell');
                    if (!cell || !editingMode) return;
                    if (overlay.style.display === 'block') return;

                    if (selectedCell === cell) {
                        clearSelected();
                        return;
                    }

                    if (selectedCell && selectedCell !== cell) {
                        targetCell = cell;
                        if (canMerge(selectedCell, cell)) {
                            showActionModal();
                        } else {
                            showConfirmModal();
                        }
                        return;
                    }

                    clearSelected();
                    cell.classList.add('selected');
                    selectedCell = cell;
                    updateButtonStates();
                });

                // 全局点击取消选中
                document.addEventListener('click', function(e) {
                    if (!editingMode) return;
                    if (overlay.style.display === 'block') return;
                    if (floatEditPanel.style.display === 'flex') return;
                    if (e.target.closest('.course-cell')) return;
                    clearSelected();
                });

                // 悬浮效果
                table.addEventListener('mouseover', function(e) {
                    const cell = e.target.closest('.course-cell');
                    if (!cell || !editingMode || !selectedCell || cell === selectedCell) return;
                    if (overlay.style.display === 'block') return;

                    if (canMerge(selectedCell, cell)) {
                        cell.classList.add('merge-hover');
                    } else {
                        cell.classList.add('copy-hover');
                    }
                });

                table.addEventListener('mouseout', function(e) {
                    const cell = e.target.closest('.course-cell');
                    if (cell) cell.classList.remove('merge-hover', 'copy-hover');
                });

                // 双击编辑
                table.addEventListener('dblclick', function(e) {
                    const cell = e.target.closest('.course-cell');
                    if (!cell || !editingMode) return;
                    if (overlay.style.display === 'block') return;

                    e.stopPropagation();
                    document.getElementById('editName').value = cell.dataset.name || '';
                    document.getElementById('editLocation').value = cell.dataset.location || '';
                    document.getElementById('editTeacher').value = cell.dataset.teacher || '';
                    document.getElementById('editType').value = cell.dataset.type || 'none';

                    const x = e.clientX, y = e.clientY;
                    const panelWidth = 260, panelHeight = floatEditPanel.offsetHeight || 200;
                    let left = x + 10, top = y + 10;

                    if (left + panelWidth > window.innerWidth) left = x - panelWidth - 10;
                    if (top + panelHeight > window.innerHeight) top = y - panelHeight - 10;
                    if (left < 0) left = 10;
                    if (top < 0) top = 10;

                    floatEditPanel.style.left = left + 'px';
                    floatEditPanel.style.top = top + 'px';
                    floatEditPanel.style.display = 'flex';
                    currentEditingCell = cell;
                });

                // 编辑面板保存
                document.getElementById('panelSave').addEventListener('click', function() {
                    if (!currentEditingCell) return;
                    const name = document.getElementById('editName').value.trim();
                    const location = document.getElementById('editLocation').value.trim();
                    const teacher = document.getElementById('editTeacher').value.trim();
                    const type = document.getElementById('editType').value;

                    currentEditingCell.dataset.name = name;
                    currentEditingCell.dataset.location = location;
                    currentEditingCell.dataset.teacher = teacher;
                    currentEditingCell.dataset.type = type;
                    updateCellDisplay(currentEditingCell, name, location, teacher, type);
                    hideEditPanel();
                });

                document.getElementById('panelCancel').addEventListener('click', hideEditPanel);

                // 操作弹窗按钮
                document.getElementById('modalMergeBtn').addEventListener('click', function() {
                    if (selectedCell && targetCell) {
                        mergeCells(selectedCell, targetCell);
                    }
                    hideAllModals();
                });

                document.getElementById('modalCopyBtn').addEventListener('click', function() {
                    if (selectedCell && targetCell) {
                        copyCourseInfo(selectedCell, targetCell);
                        clearSelected();
                        targetCell.classList.add('selected');
                        selectedCell = targetCell;
                        updateButtonStates();
                    }
                    hideAllModals();
                });

                document.getElementById('modalCancelBtn').addEventListener('click', hideAllModals);

                document.getElementById('confirmCopyBtn').addEventListener('click', function() {
                    if (selectedCell && targetCell) {
                        copyCourseInfo(selectedCell, targetCell);
                        clearSelected();
                        targetCell.classList.add('selected');
                        selectedCell = targetCell;
                        updateButtonStates();
                    }
                    hideAllModals();
                });

                document.getElementById('confirmCancelBtn').addEventListener('click', hideAllModals);

                // 点击编辑面板外关闭
                document.addEventListener('click', function(e) {
                    if (floatEditPanel.style.display !== 'flex') return;
                    if (floatEditPanel.contains(e.target)) return;
                    if (e.target.closest('.course-cell') === currentEditingCell) return;
                    hideEditPanel();
                });
            }

            // ========== 主题切换功能 ==========
            const btnOriginal = document.getElementById('btn-original');
            const btnCandy = document.getElementById('btn-candy');
            const btnForest = document.getElementById('btn-forest');
            const btnPixel = document.getElementById('btn-pixel');
            const body = document.body;
            const allBtns = [btnOriginal, btnCandy, btnForest, btnPixel];

            const savedTheme = localStorage.getItem('selectedTheme') || 'theme-original';
            body.className = savedTheme;

            function setActiveButtonFromBodyClass() {
                allBtns.forEach(btn => btn.classList.remove('active'));
                if (body.classList.contains('theme-original')) btnOriginal.classList.add('active');
                else if (body.classList.contains('theme-candy')) btnCandy.classList.add('active');
                else if (body.classList.contains('theme-forest')) btnForest.classList.add('active');
                else if (body.classList.contains('theme-pixel')) btnPixel.classList.add('active');
            }
            setActiveButtonFromBodyClass();

            function saveTheme(themeClass) {
                localStorage.setItem('selectedTheme', themeClass);
            }

            btnOriginal.addEventListener('click', function() {
                body.className = 'theme-original';
                setActiveButtonFromBodyClass();
                saveTheme('theme-original');
            });
            btnCandy.addEventListener('click', function() {
                body.className = 'theme-candy';
                setActiveButtonFromBodyClass();
                saveTheme('theme-candy');
            });
            btnForest.addEventListener('click', function() {
                body.className = 'theme-forest';
                setActiveButtonFromBodyClass();
                saveTheme('theme-forest');
            });
            btnPixel.addEventListener('click', function() {
                body.className = 'theme-pixel';
                setActiveButtonFromBodyClass();
                saveTheme('theme-pixel');
            });

            // ========== 初始化课程表 ==========
            initMetadata();
            loadFromStorage();
            renderFooter();
            initEventListeners();
        })();
    </script>
</body>
</html>